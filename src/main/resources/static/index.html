<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FCM Token Fetcher</title>
</head>
<body>
<h1>FCM Token Fetcher</h1>
<button id="get-token">Request Notification Permission</button>
<p id="output"></p>

<script type="module">
    // Import Firebase modules
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.21.0/firebase-app.js";
    import { getMessaging, getToken, onMessage } from "https://www.gstatic.com/firebasejs/9.21.0/firebase-messaging.js";

    // Firebase configuration (replace with your project's config)
    const firebaseConfig = {
        apiKey: "AIzaSyBCHjGjYjeHJ_BfnYr6971MNAmLmedWKa8",
        authDomain: "early-table-6315a.firebaseapp.com",
        projectId: "early-table-6315a",
        storageBucket: "early-table-6315a.appspot.com",
        messagingSenderId: "531693985268",
        appId: "1:531693985268:web:404dd20c73d5d90e416da1",
        measurementId: "G-2K9VLFMZK3"
    };

    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const messaging = getMessaging(app);

    // Register Service Worker
    if ('serviceWorker' in navigator) {
        navigator.serviceWorker.register('/firebase-messaging-sw.js')
            .then((registration) => {
                console.log("Service Worker registered successfully:", registration);
            })
            .catch((error) => {
                console.error("Service Worker registration failed:", error);
            });
    }

    // Request Notification Permission and Get Token
    document.getElementById('get-token').addEventListener('click', async () => {
        try {
            const permission = await Notification.requestPermission();
            if (permission === 'granted') {
                const vapidKey = "BCblvSlG7R-AcUqBwKPEUyVpo-p--PinoJY6h_gNyqwY9l6uk1WyEetuKA77hwR3M_REhJ0ckgc9Jm3yuHiNmy0"; // Replace with your VAPID key
                const token = await getToken(messaging, { vapidKey });
                console.log("FCM Token:", token);
                document.getElementById('output').textContent = `Your FCM Token: ${token}`;
            } else {
                console.error("Notification permission not granted.");
                document.getElementById('output').textContent = "Permission not granted for notifications.";
            }
        } catch (error) {
            console.error("Error getting FCM token:", error);
            document.getElementById('output').textContent = `Error: ${error.message}`;
        }
    });

    // Handle incoming messages
    onMessage(messaging, (payload) => {
        console.log("Message received:", payload);
        alert(`Notification: ${payload.notification.title} - ${payload.notification.body}`);
    });
</script>
</body>
</html>
